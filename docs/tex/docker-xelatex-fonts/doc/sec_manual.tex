\section{РУКОВОДСТВО ПОЛЬЗОВАТЕЛЯ}
\label{sec:manual}

\def\dc{Docker}

В данном разделе будет описана последовательность действий, которую необходимо произвести пользователям для использования данного программного продукта.

Сам продукт распространяется в качестве проекта с открытым исходным кодом по лицензии Apache License.
Это означает, что каждый желающий может присоединиться к разработке и дальнейшему развитию проекта.

По этой причине, важную часть проекта также занимает документация и инструменты непрерывной интеграции.

Данный проект может использоваться как отдельная программа в локальной системе, либо в качестве компонента более масштабной системы.
По этой причине продукт можно сконфигурировать под разные окружения.

Основные режимы работы:
\begin{itemize}
    \item Локальный режим;
    \item Режим кластера.
\end{itemize}

\subsection{Руководство для локального режима}

Данное руководство предназначено для локальной развёртки приложения и работы на одной машине.

\subsubsection{Требования к программному обеспечению}

Для корректной сборки и работы данного дипломного проекта требуется следующее программное обеспечение:
\begin{itemize}
    \item Docker-compose версии выше 1.10.0+ (поддерживающий API версии 2.0);
    \item любой веб-браузер.
\end{itemize}

Для работы продукта в локальном режиме будет достаточно вышеперечисленного программного обеспечения.
Всё окружение, которое необходимо для работы компонентов системы обеспечивается с помощью Docker образов, а все компоненты системы работают в контейнере.

\subsubsection{Настройка рабочего окружения}

В первую очередь, необходимо установить docker-compose.
Инструкцию по установке данного инструмента для своей операционной системы можно найти на официальном сайте ~\cite{docker_compose_install_site}

Ниже приведён пример установки docker-compose для операционной системы Centos 7:

\begin{lstlisting}
$ export DOCKER_COMPOSE_VERSION='1.24.0'
$ sudo yum remove docker \
    docker-client \
    docker-client-latest \
    docker-common \
    docker-latest \
    docker-latest-logrotate \
    docker-logrotate \
    docker-engine
$ sudo yum install -y yum-utils \
    device-mapper-persistent-data \
    lvm2
$ sudo yum-config-manager \
    --add-repo \
    https://download.docker.com/linux/centos/docker-ce.repo
$ sudo yum install docker-ce docker-ce-cli containerd.io
$ sudo curl -L "https://github.com/docker/compose/releases/download/$DOCKER_COMPOSE_VERSION/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose
$ sudo chmod +x /usr/local/bin/docker-compose
$ sudo systemctl start docker
$ sudo usermod -aG docker $(whoami)
\end{lstlisting}

Для проверки корректности установки следует использовать следующие команды:

\begin{lstlisting}
$ docker run hello-world
$ docker-compose --version
\end{lstlisting}

Браузер необходим для взаимодействия с интерактивными документами.
Для примера 

\begin{lstlisting}
$ sudo yum install -y firefox    
\end{lstlisting}



Для корректной работы с разработанным программным обеспечением и модулями
тестирования требуется произвести настройку рабочего окружения разработчика
и установить требуемое программное обеспечение.

В первую очередь, требуется установить операционную систему Ubuntu требуемой
версии. Скачать требуемую версию можно из источника~\cite{ubuntu_download_site}.
Подробная инструкция по ее установке на английском языке располагается
в источнике~\cite{ubuntu_how_to_install}.

После успешной установки требуемой операционной системы, пользователь должен
установить недостающие системные утилиты с помощью следующего набора команд:
\begin{lstlisting}
$ sudo apt update
$ sudo apt install -y tar gcc make firefox
\end{lstlisting}

Затем требуется вставить
DVD-диск, который предоставлен вместе с данным дипломным проектом, во включенный
персональный компьютер пользователя с установленной Ubuntu требуемой версии.
На диске содержатся исходные коды проекта, а также часть программного обеспечения
требуемых версий.

Следующим шагом является монтирование подключенного диска в систему.
В большинстве случаев, Ubuntu делает это в автоматическом режиме, но эта
функция отключается. Предположив, что в системе представлен всего
один дисковод, приведем список команд для монтирования содержимого
в папку \lstinline{/mnt/cdrom} с просмотром содержимого диска:
\begin{lstlisting}
$ mkdir /mnt/cdrom
$ sudo mount /dev/sr0 /mnt/cdrom
$ ls -l /mnt/cdrom
\end{lstlisting}

Далее необходимо скопировать содержимое DVD-диска на жесткий диск
персонального компьютера в пустую директорию, не нарушая внутреннюю структуру
расположения копируемых файлов. Для примера, скопируем содержимое диска в папку
\lstinline{diploma} домашнего каталога пользователя:
\begin{lstlisting}
$ mkdir ~/diploma
$ cp -r /dev/sr0/* ~/diploma/
\end{lstlisting}

Следующим шагом необходимо произвести установку Поскольку
по умолчанию она поставляется в виде zip-архива, в консоли нужно выполнить
следующий набор команд для распаковки архива и запуска установки интегрированной
среды разработки:
\begin{lstlisting}
$ cd ~/diploma/soft/ccs/
$ tar xf CCS8.1.0.00011_linux-x64.tar.gz
$ cd CCS8.1.0.00011_linux-x64/
$ ./ccs_setup_linux64_8.1.0.00011.bin
\end{lstlisting}

В результате программа отобразит свой графический интерфейс, в котором требуется
согласиться с лицензионным соглашением и оставить неизменным каталог установки
среды разработки (по умолчанию программное обеспечение устанавливается в
подкаталог \lstinline{ti} домашней директории пользователя). Также обязательно требуется
выбрать следующие пункты при выборе поддерживаемых продуктов:
\begin{itemize}
    \item Sitara\texttrademark{} AMx Processors;
    \item C6000 Power-Optimized DSP.
\end{itemize}

После завершения установки , требуется установить TI-RTOS SDK.
Для запуска графического интерфейса установки выполните следующую последовательность
команд:
\begin{lstlisting}
$ cd ~/diploma/soft/sdk/
$ chmod +x ti-processor-sdk-rtos-am57xx-evm-05.03.00.07-Linux-x86-Install.bin
$ ./ti-processor-sdk-rtos-am57xx-evm-05.03.00.07-Linux-x86-Install.bin
\end{lstlisting}

В результате появится графический интерфейс, в котором требуется выбрать все
компоненты и произвести установку в папку по умолчанию, которая совпадает
папкой для .

Следующим шагом является запуск , выбор в нем каталога рабочего окружения,
который рекомендуется оставить неизменной. Также рекомендуется отметить отказ
об уточнении его местоположения каждый раз при запуске IDE.

После запуска,  обнаружит установленный TI-RTOS SDK и предложит его
установить. Выберите <<Установить>>, и в последствии разрешайте устанавливать
неподписанные  пакеты. Следующим шагом будет перезапуск IDE после появления
соответствующего предложения.

Как было сказано ранее, для запуска эмулятора сетевой части прибора, потребуется
установка веб-сервера nodejs. В соответствии с инструкцией по
установке~\cite{nodejs_how_to_install}, требуется выполнить следующий
набор команд:
\begin{lstlisting}
$ curl -sL https://deb.nodesource.com/setup_10.x | sudo -E bash -
$ sudo apt-get install -y nodejs
\end{lstlisting}

Таким образом, в данном пункте описано конфигурирование рабочего окружения для
тестирования данного дипломного проекта, а также разработки с его использованием.

\subsubsection{Запуск тестирования}

Для запуска модульных тестов необходимо собрать и запустить тесты. Сделать это
можно следующим набором команд:
\begin{lstlisting}
$ cd ~/diploma/tests/websocket/
$ make clean all
\end{lstlisting}

В результате на экране должен появиться вывод, аналогичный
рисунку~\ref{pic:testing:websockUnityTest}.

Для запуска эмулятора требуется выполнить следующий набор команд:
\begin{lstlisting}
$ cd ~/diploma/tests/visual/
$ npm i
$ npm test
\end{lstlisting}

Первая команда перейдет в нужную директорию, вторая скачает и установит требуемые
для работы эмулятора зависимости, а третья произведет запуск эмулятора. В результате
в консоли появится вывод, аналогичный рисунку%~\ref{pic:manual:npmTestOut}.

%\begin{figure}
%    \centering
%    \includegraphics[width=0.8\textwidth]{npm_test_output}
%    \caption{Результат инициализации и запуска эмулятора сетевой части устройства
%    на персональном компьютере}
%    \label{pic:manual:npmTestOut}
%\end{figure}

Следующим шагом является запуск веб-браузера. Для тестирования
рекомендуется использовать Mozilla Firefox указанной ранее версии.

Для доступа к эмулятору в адресной строке браузера наберите \lstinline{localhost:3000},
и у вас откроется тестовая страница, которая доступна на приборе.
В результате на странице веб-браузера должно отобразиться содержимое,
аналогичное рисунку~\ref{pic:testing:nodejs_Tasks}.
В данном случае веб-страница будет использовать псевдослучайные последовательности
загрузки устройства, генерируемые веб-сервером, для демонстрации работы модуля
отображения данных.

Таким образом, в данном пункте описан алгоритм запуска проверки работоспособности
модулей, которые взаимодействуют со сторонним программным обеспечением.

\subsubsection{Демонстрация работы библиотеки}

Для демонстрации работы библиотеки был разработан набор тестовых проектов
для , которые позволяют увидеть пример работы на реальном оборудовании.
Поскольку эти проекты разработаны для отладочной платы ,
она требуется для исполнения кода.

Сначала нужно импортировать подготовленные проекты в . Для этого нужно
открыть IDE и совершить следующую последовательность действий:
\begin{enumerate_num}
    \item Выбрать в меню окна \lstinline{File}, в выпадающем меню \lstinline{Import}.
    \item В появившемся окне выбрать \texttt{ -> CCS projects}.
    Нажать кнопку \lstinline{Next}.
    \item Нажать кнопку \lstinline{Browse}. Выбрать директорию
    \lstinline{~/diploma/projects}.
    \item Отметить все четыре проекта в поле \lstinline{Discovered Projects}.
    Убрать отметку с пункта \lstinline{Copy projects into workspace}.
    Нажать \lstinline{Finish}.
\end{enumerate_num}

В результате успешного импорта проектов, они отобразятся в разделе
\lstinline{Project Explorer}.

Далее нужно произвести компиляцию добавленных проектов. Для этого
по каждому из них нужно нажать правой клавишей мыши и в контекстном меню
выбрать пункт \lstinline{Rebuild Project}.

После компиляции требуется сгенерировать содержимое SD карты памяти для устройства:
файлы \lstinline{MLO} и \lstinline{app}. Первый файл является файлом вторичного загрузчика,
второй -- файлом основной прошивки прибора.
Для этого требуется выполнить следующий набор команд:
\begin{lstlisting}
$ cd ~/diploma/
$ mkdir sdcard
$ export BIN_PATH=sdcard
$ cp $HOME/ti/pdk_am57xx_1_0_14/packages/ti/boot/sbl/binary/idkAM572x/mmcsd/bin/MLO sdcard/
$ export APP_MPU_CPU0=projects/diploma_host/Debug/diploma_host.out
$ export APP_IPU1_CPU0=projects/diploma_ipu1/Debug/diploma_ipu1.out
$ export APP_DSP1=projects/diploma_dsp1/Debug/diploma_dsp1.out
$ export APP_DSP2=projects/diploma_dsp2/Debug/diploma_dsp2.out
$ $HOME/ti/pdk_am57xx_1_0_14/packages/ti/boot/sbl/tools/scripts/AM57xImageGen.sh
\end{lstlisting}

Следующим шагом является создание самой загрузочной SD карты памяти. Подробная
инструкция представлена в источнике~\cite{tirtos_sdcard_create_site} на
английском языке. В качестве пути с файлами для создания карты памяти
требуется указать путь \lstinline{$HOME/diploma/sdcard/}.

После успешного создания карты памяти ее требуется вставить в отладочную плату,
на которой будет производиться тестирование.

Последующие действия для проверки описаны в руководстве конечного пользователя.

Описанным выше методом можно воспроизвести пример использования библиотеки на
конечном устройстве. Тестовые проекты могут выступить в качестве варианта
импорта их в разрабатываемый аппаратно-программный комплекс.

В данном подразделе описано руководство разработчика,
которое отображает основные стороны взаимодействия с разработанной библиотекой.
Оно позволит ускорить интеграцию в разрабатываемые проекты и лучше понять
схему работы программного продукта.

\subsection{Руководство конечного пользователя}

В данном подразделе будет описан пример руководства конечного пользователя,
который должен взаимодействовать с библиотекой, на примере отладочной платы
. Руководство должно пройти стадию адаптации для конечного
аппаратно-программного комплекса.

Требования к аппаратному обеспечению:
\begin{itemize}
    \item отладочная плата ;
    \item витая пара категории 5E или выше;
    \item персональный компьютер с сетевой картой.
\end{itemize}

Требования к программному обеспечению:
\begin{itemize}
    \item веб-браузер Mozilla Firefox версии 66.0.3 или выше.
\end{itemize}

Для запуска отладочной платы подключите к ней блок питания, поставляемый в
комплекте, в разъем J1 на плате и в розетку на 220В переменного тока.
Нажмите кнопку SW3 <<Power On>> для подачи питания на процессор.

Для взаимодействия с платой подключите провод витой пары одним концом в разъем J10
<<Gigabit Ethernet 0>>, а вторым концом -- в сетевую карту персонального компьютера.
Настройте на подключенной сетевой карте статический IP-адрес 192.168.1.1 c
маской подсети 255.255.255.0. Инструкции по настройке сетевых интерфейсов вы можете
найти в документации на используемую вами операционную систему.

Откройте указанный в требованиях к программному обеспечению веб-браузер,
наберите в адресной строке IP-адрес прибора 192.168.1.2 и нажмите <<Ввод>>.
В результате отобразится веб-страница, аналогичная
рисунку%~\ref{pic:manual:deviceTestOut}.

%\begin{figure}
    %\centering
    %\includegraphics[width=0.8\textwidth]{device_webpage}
    %\caption{Пример работы устройства}
    %\label{pic:manual:deviceTestOut}
%\end{figure}

Таким образом, выше представлено два руководства пользователя. Первое
предназначено для интеграции разрабатываемой библиотеки в другую библиотеку
или конечный продукт, второе -- для интеграции в руководство пользователя для
конечного продукта, который использует результаты данного дипломного проекта.
